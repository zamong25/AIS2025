# 델파이 트레이딩 시스템 아키텍처

## 시스템 개요

델파이는 5개의 AI 에이전트가 협업하여 자율적으로 암호화폐 거래를 수행하는 시스템입니다.

```
[시장 데이터] → [4개 분석 에이전트] → [신디사이저] → [거래 실행] → [모니터링]
                        ↓
                  [시나리오 학습]
```

## 핵심 구성 요소

### 1. AI 에이전트 시스템

#### 분석 에이전트 (4개)
1. **차티스트 (Chartist)** - 기술적 분석
   - 차트 패턴 인식
   - 지지/저항선 분석
   - 추세 판단

2. **저널리스트 (Journalist)** - 뉴스/센티먼트 분석
   - 시장 뉴스 수집
   - 감성 분석
   - 이벤트 영향도 평가

3. **퀀트 (Quant)** - 정량적 분석
   - 통계적 지표 계산
   - 과거 성과 분석
   - 확률 기반 예측

4. **스토익 (Stoic)** - 리스크 관리
   - 포지션 크기 계산
   - 손절/익절 레벨 설정
   - 전체 포트폴리오 리스크 평가

#### 의사결정 에이전트
5. **신디사이저 (Synthesizer)** - 최종 의사결정
   - 4개 에이전트 의견 종합
   - 거래 신호 생성
   - 신뢰도 평가

### 2. 거래 실행 시스템

#### TradeExecutor
- 바이낸스 API 연동
- 주문 실행 및 관리
- 슬리피지 제어

#### OCOOrderManager
- 손절/익절 주문 관리
- 리스크 관리 자동화

### 3. 데이터 관리

#### TradeDatabase
- SQLite 기반 거래 기록
- 성과 통계 계산
- 유사 거래 검색

#### BinanceConnector
- 실시간 가격 데이터
- 기술적 지표 계산
- 시장 데이터 수집

#### TradingContext
- 거래 컨텍스트 관리
- 히스토리 추적
- 상태 저장/복원

### 4. 모니터링 시스템

#### PositionMonitor
- 실시간 포지션 추적
- 손익 모니터링
- 알림 발송

#### MDDTracker
- 최대 낙폭 추적
- 리스크 한도 관리

#### TriggerManager
- 가격 트리거 관리
- 조건부 주문 실행

### 5. 시나리오 학습 시스템

#### ScenarioCollector
- 거래 시나리오 수집
- 시장 컨텍스트 기록

#### ScenarioSearcher
- 유사 시나리오 검색
- 과거 성과 분석

#### WeeklyAnalyzer
- 주간 성과 분석
- 개선점 도출
- 자동 학습

## 데이터 흐름

### 1. 분석 단계
```
시장 데이터 → 4개 에이전트 병렬 분석 → 분석 결과 생성
```

### 2. 의사결정 단계
```
4개 분석 결과 → 신디사이저 종합 → 거래 신호 생성
```

### 3. 실행 단계
```
거래 신호 → 거래 실행 → OCO 주문 설정 → 포지션 모니터링
```

### 4. 학습 단계
```
거래 결과 → 시나리오 저장 → 패턴 분석 → 전략 개선
```

## 주요 데이터베이스 테이블

### trade_records
- 모든 거래 기록
- 진입/청산 정보
- 손익 및 성과 지표

### scenario_tracking
- 거래별 시나리오 정보
- 에이전트 신호 기록
- 의사결정 과정

### position_snapshots
- 포지션 상태 스냅샷
- MDD 추적
- 실시간 모니터링

### market_context
- 거래 시점 시장 상황
- 기술적 지표
- 뉴스/이벤트

## 시스템 실행 흐름

### 1. 정기 실행 (5분마다)
1. 시장 데이터 수집
2. 트리거 확인
3. 4개 에이전트 분석
4. 신디사이저 의사결정
5. 거래 실행 (필요시)
6. 포지션 모니터링

### 2. 포지션 보유 중
1. 실시간 가격 모니터링
2. 손절/익절 체크
3. 포지션 트리거 관리
4. MDD 추적
5. 필요시 포지션 조정

### 3. 포지션 청산 후
1. 거래 결과 저장
2. 시나리오 기록
3. 성과 분석
4. 학습 데이터 축적

## 외부 연동

### Binance API
- 선물 거래
- 실시간 가격
- 주문 관리

### Discord Webhook
- 거래 알림
- 에러 알림
- 일일 리포트

### Claude/Gemini API
- AI 에이전트 추론
- 자연어 분석
- 패턴 인식

## 보안 및 안정성

### API 키 관리
- 환경 변수 사용
- .env 파일 격리

### 에러 처리
- 재시도 로직
- 폴백 메커니즘
- 상세 로깅

### 데이터 백업
- 자동 백업
- 히스토리 관리
- 복구 메커니즘