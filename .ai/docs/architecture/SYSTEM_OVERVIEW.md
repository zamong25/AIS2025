# 📊 델파이 트레이딩 시스템 전체 개요

> 최종 업데이트: 2025-01-12  
> 작성자: Claude AI Assistant + 개발팀

## 📋 목차
1. [시스템 소개](#시스템-소개)
2. [아키텍처](#아키텍처)
3. [핵심 구성요소](#핵심-구성요소)
4. [개발 현황](#개발-현황)
5. [알려진 문제점](#알려진-문제점)
6. [시스템 플로우](#시스템-플로우)

---

## 시스템 소개

델파이는 고대 그리스 델파이 신전의 현인들처럼, 5명의 전문 AI 에이전트가 협업하여 암호화폐 거래를 수행하는 자율 트레이딩 시스템입니다.

### 왜 멀티 에이전트인가?
- **단일 AI의 한계 극복**: 각 전문 분야별 AI가 깊이 있는 분석
- **집단 지성**: 다양한 관점을 종합하여 더 나은 결정
- **리스크 분산**: 한 AI의 오류가 전체 시스템을 망치지 않음

### 현재 상태
- **버전**: 3.0 (시나리오 기반 재설계 완료)
- **완성도**: 85-90%
- **거래 자산**: Solana (SOL/USDT) 선물
- **거래소**: Binance Futures

---

## 아키텍처

### 시스템 구조도
```
┌─────────────────────────────────────────────────────────┐
│                     Orchestrator                         │
│                    (main.py)                            │
└────────────────────┬───────────────────────────────────┘
                     │
        ┌────────────┴────────────┐
        │                         │
┌───────▼────────┐       ┌───────▼────────┐
│ Data Collector │       │ Chart Capture  │
│                │       │                │
└───────┬────────┘       └───────┬────────┘
        │                         │
        └────────────┬────────────┘
                     │
     ┌───────────────┼───────────────┐
     │               │               │
┌────▼────┐    ┌────▼────┐    ┌────▼────┐
│Chartist │    │Journalist│    │  Quant  │
│         │    │          │    │         │
└────┬────┘    └────┬────┘    └────┬────┘
     │               │               │
     └───────────────┼───────────────┘
                     │
                ┌────▼────┐
                │  Stoic  │
                │         │
                └────┬────┘
                     │
              ┌──────▼──────┐
              │Synthesizer  │
              │             │
              └──────┬──────┘
                     │
              ┌──────▼──────┐
              │Trade Executor│
              │             │
              └──────┬──────┘
                     │
              ┌──────▼──────┐
              │   Binance   │
              │   Futures   │
              └─────────────┘
```

### 기술 스택
- **언어**: Python 3.8+
- **AI 모델**: Google Gemini (Flash 2.0 & Pro)
- **거래소 API**: Binance Futures API
- **데이터베이스**: SQLite
- **모니터링**: Discord Webhooks
- **스케줄링**: Windows Task Scheduler / Python schedule

---

## 핵심 구성요소

### 1. AI 에이전트 (src/agents/)

#### 🎨 차티스트 (Chartist)
- **역할**: 차트 패턴 분석
- **분석 내용**: 
  - 4개 타임프레임 (5분, 15분, 1시간, 1일)
  - 3개 시나리오 제시 (상승/하락/횡보)
  - 각 시나리오별 확률, 진입가, 목표가, 손절가
- **특징**: 확률 자동 정규화 (합계 100%)

#### 📰 저널리스트 (Journalist)
- **역할**: 뉴스 및 시장 이벤트 분석
- **분석 내용**:
  - 실시간 뉴스 수집 (CoinDesk, CoinTelegraph)
  - 팩트 기반 보고 (주관적 해석 배제)
  - 시장 영향도 점수 (1-10)
- **특징**: 타임스탬프와 출처 명시

#### 📊 퀀트 (Quant)
- **역할**: 기술적 지표 분석
- **분석 내용**:
  - 멀티 타임프레임 지표 (RSI, MACD, 볼린저밴드 등)
  - 차티스트 시나리오 검증
  - 과거 유사 패턴 매칭
- **특징**: v3에서 "변화 추적 퀀트"로 업그레이드

#### 🛡️ 스토익 (Stoic)
- **역할**: 리스크 관리
- **분석 내용**:
  - 적응형 레버리지 결정 (5-20x)
  - 포지션 크기 계산
  - 기존 포지션 전환 전략
- **특징**: 시장 변동성에 따른 동적 조정

#### 🧠 신디사이저 (Synthesizer)
- **역할**: 최종 의사결정
- **분석 내용**:
  - 모든 에이전트 분석 종합
  - 거래 실행 결정 (BUY/SELL/HOLD)
  - 트리거 설정
- **특징**: Phase 5에서 이미지 직접 분석 예정

### 2. 거래 시스템 (src/trading/)

#### 거래 실행 (trade_executor.py)
- Binance Futures API 연동
- 시장가/지정가 주문 실행
- 슬리피지 관리

#### OCO 주문 관리 (oco_order_manager.py)
- One-Cancels-Other 주문
- 자동 손절/익절 설정
- 24/7 리스크 관리

#### 포지션 상태 관리 (position_state_manager.py)
- Single Source of Truth
- 바이낸스 API 기준 상태 관리
- Trading Context 동기화

### 3. 데이터 관리 (src/data/)

#### Trading Context (trading_context.py)
- 거래 연속성 유지
- 진입 시점의 가설 저장
- 포지션 진행 상황 추적

#### 거래 데이터베이스 (trade_database.py)
- SQLite 기반
- 모든 거래 이력 저장
- 성과 분석용 데이터

### 4. 모니터링 (src/monitoring/)

#### 하트비트 체커 (heartbeat_checker.py)
- 1분 단위 시스템 상태 확인
- 트리거 체크
- 자동 복구

#### 일일 리포터 (daily_reporter.py)
- 매일 자정 성과 보고
- 거래 통계 분석
- Discord 알림

---

## 알려진 문제점

### 🔴 심각 - 가짜 학습 시스템
```python
# 현재 코드 (문제)
success_rate = 0.5 + (random.random() - 0.5) * 0.2  # 랜덤값!

# 필요한 구현
success_rate = calculate_actual_performance(agent, trade_result)
```
- **문제**: AI 가중치가 실제 성과가 아닌 랜덤값 사용
- **영향**: 시스템이 경험에서 학습하지 못함
- **해결**: 실제 성과 측정 시스템 구현 필요

### 🟡 중간 - 15분 지연 트리거
- **문제**: 트리거가 15분마다만 확인됨
- **영향**: 급격한 시장 변화에 늦게 반응
- **해결**: WebSocket + 실시간 트리거 연동

### 🟢 경미 - 단일 자산 한계
- **문제**: SOL만 거래 가능
- **영향**: 포트폴리오 다변화 불가
- **해결**: 멀티 자산 지원 개발

---

## 시스템 플로우

### 1. 정기 실행 (15분마다)
```
스케줄러 트리거
    ↓
차트 캡처 (4개 타임프레임)
    ↓
데이터 수집 (가격, 거래량, 뉴스)
    ↓
5개 AI 에이전트 병렬 분석
    ↓
신디사이저 종합 판단
    ↓
거래 결정 (진입/유지/청산)
    ↓
실행 및 OCO 주문 설정
    ↓
Discord 알림 발송
```

### 2. 실시간 모니터링 (1분마다)
```
하트비트 체크
    ↓
포지션 상태 확인
    ↓
트리거 조건 체크
    ↓
필요시 즉시 재분석
```

### 3. 포지션 관리
```
진입 → Trading Context 생성
    ↓
유지 중 → 15분마다 진행상황 평가
    ↓
종료 → Context를 history 폴더로 아카이브
```

---

## 데이터 흐름

```
[외부 데이터]
    ├── Binance API → 가격/거래량
    ├── TradingView → 차트 이미지
    └── News API → 뉴스/이벤트
            ↓
    [데이터 수집/가공]
            ↓
    [AI 에이전트 분석]
            ↓
    [의사결정 & 실행]
            ↓
[결과 저장]
    ├── SQLite DB → 거래 기록
    ├── JSON → Trading Context
    └── Discord → 실시간 알림
```

---

## 보안 및 안전장치

1. **API 키 관리**: 환경 변수 사용
2. **일일 손실 한도**: 5% 자동 차단
3. **긴급 청산**: 10% 손실 시 강제 청산
4. **포지션 크기 제한**: 최대 30%
5. **레버리지 한도**: 최대 20배

---

## 성능 지표

- **응답 시간**: 전체 분석 약 30-60초
- **API 호출**: 15분당 약 20-30회
- **메모리 사용**: 평균 500MB
- **디스크 사용**: 일일 약 50MB 증가

---

*이 문서는 시스템의 전체적인 이해를 돕기 위해 작성되었습니다. 기술적 세부사항은 [TECHNICAL_DETAILS.md](./TECHNICAL_DETAILS.md)를 참조하세요.*